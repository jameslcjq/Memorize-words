import{r as i,a as e,j as t}from"./index-0b56841e.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(r,l){return this.cache.has(r)?this.cache.get(r):(this.cache.set(r,l),l)}};const k=()=>{const[r,l]=i.useState(""),[x,p]=i.useState(!1),[s,y]=i.useState(null),[u,b]=i.useState([]),[h,m]=i.useState(!1),g=async a=>{m(!0);try{const d=await fetch("/api/admin/stats",{headers:{"x-admin-password":a}});if(d.ok){p(!0);const o=await d.json();y(o.data);const c=await(await fetch("/api/admin/users",{headers:{"x-admin-password":a}})).json();b(c.data),sessionStorage.setItem("admin_pwd",a)}else alert("密码错误")}catch{alert("连接错误")}finally{m(!1)}};i.useEffect(()=>{const a=sessionStorage.getItem("admin_pwd");a&&(l(a),g(a))},[]);const w=async a=>{const d=prompt("请输入新密码：");if(!d)return;const o=sessionStorage.getItem("admin_pwd");if(o)try{const n=await fetch("/api/admin/reset_password",{method:"POST",headers:{"Content-Type":"application/json","x-admin-password":o},body:JSON.stringify({userId:a,newPassword:d})});if(n.ok)alert("密码重置成功");else{const c=await n.json();alert("重置失败: "+c.error)}}catch(n){alert("操作失败: "+n.message)}},f=a=>{a.preventDefault(),g(r)};return x?e("div",{className:"min-h-screen bg-gray-50 p-8 dark:bg-gray-900",children:t("div",{className:"mx-auto max-w-6xl",children:[t("header",{className:"mb-8 flex items-center justify-between",children:[e("h1",{className:"text-3xl font-bold dark:text-white",children:"后台管理面板"}),e("button",{onClick:()=>{sessionStorage.removeItem("admin_pwd"),window.location.reload()},className:"text-red-500 hover:underline",children:"退出登录"})]}),t("div",{className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-3",children:[t("div",{className:"rounded-xl bg-white p-6 shadow dark:bg-gray-800",children:[e("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"用户总数"}),e("p",{className:"mt-2 text-3xl font-bold text-indigo-600",children:(s==null?void 0:s.totalUsers)||0})]}),t("div",{className:"rounded-xl bg-white p-6 shadow dark:bg-gray-800",children:[e("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"总打卡次数"}),e("p",{className:"mt-2 text-3xl font-bold text-green-600",children:(s==null?void 0:s.totalRecords)||0})]}),t("div",{className:"rounded-xl bg-white p-6 shadow dark:bg-gray-800",children:[e("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"今日活跃用户"}),e("p",{className:"mt-2 text-3xl font-bold text-blue-600",children:(s==null?void 0:s.activeUsersToday)||0})]})]}),t("div",{className:"overflow-hidden rounded-xl bg-white shadow dark:bg-gray-800",children:[e("div",{className:"border-b border-gray-100 px-6 py-4 dark:border-gray-700",children:e("h2",{className:"text-lg font-semibold dark:text-white",children:"最新注册用户"})}),e("div",{className:"overflow-x-auto",children:t("table",{className:"w-full text-left text-sm",children:[e("thead",{className:"bg-gray-50 text-gray-500 dark:bg-gray-700 dark:text-gray-400",children:t("tr",{children:[e("th",{className:"px-6 py-3",children:"昵称"}),e("th",{className:"px-6 py-3",children:"账号"}),e("th",{className:"px-6 py-3",children:"注册时间"}),e("th",{className:"px-6 py-3",children:"用户ID"}),e("th",{className:"px-6 py-3",children:"操作"})]})}),e("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700 dark:text-gray-300",children:u.map(a=>t("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e("td",{className:"px-6 py-4 font-medium",children:a.nickname}),e("td",{className:"px-6 py-4",children:a.username}),e("td",{className:"px-6 py-4",children:new Date(a.createdAt).toLocaleString()}),e("td",{className:"px-6 py-4 font-mono text-xs text-gray-400",children:a.id}),e("td",{className:"px-6 py-4",children:e("button",{onClick:()=>w(a.id),className:"text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300",children:"重置密码"})})]},a.id))})]})})]})]})}):e("div",{className:"flex h-screen w-full items-center justify-center bg-gray-50 dark:bg-gray-900",children:t("form",{onSubmit:f,className:"w-80 space-y-4 rounded-lg bg-white p-8 shadow-lg dark:bg-gray-800",children:[e("h2",{className:"text-center text-xl font-bold dark:text-white",children:"管理员登录"}),e("input",{type:"password",className:"w-full rounded border p-2 dark:bg-gray-700 dark:text-white",placeholder:"请输入管理员密码",value:r,onChange:a=>l(a.target.value)}),e("button",{type:"submit",disabled:h,className:"w-full rounded bg-indigo-600 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",children:h?"验证中...":"登录"})]})})};export{k as default};
