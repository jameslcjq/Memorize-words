import{r as x,d as y,a as h,u as b,b as w,c as f,j as t,L as v,e as n,t as N,$ as k,f as W,F as $,g as D,i as C}from"./index-b776116e.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(a,s){return this.cache.has(a)?this.cache.get(a):(this.cache.set(a,s),s)}};function j(a,s){const d=[];let o=h(a).startOf("day");const i=h(s).endOf("day");for(;o.diff(i)<0;)d.push(o.clone().format("YYYY-MM-DD")),o=o.add(1,"day");return d}function A(a,s){const[d,o]=x.useState({stats:{all:[],typing:[],"word-to-trans":[],"trans-to-word":[]}});return x.useEffect(()=>{(async()=>{const c=await M(a,s);o(c)})()},[a,s]),d}async function M(a,s){const d=await y.wordRecords.where("timeStamp").between(a,s).toArray();if(d.length===0)return{isEmpty:!0,stats:{all:[],typing:[],"word-to-trans":[],"trans-to-word":[]}};const o=g=>g.map(r=>({[r]:{words:[],wrongWordsList:[]}})).reduce((r,l)=>({...r,...l}),{}),i=j(a*1e3,s*1e3),c={all:o(i),typing:o(i),"word-to-trans":o(i),"trans-to-word":o(i)};for(let g=0;g<d.length;g++){const r=d[g],l=h(r.timeStamp*1e3).format("YYYY-MM-DD"),e=r.mode||"typing",u=m=>{m[l]&&(m[l].words.push(r.word),r.wrongCount>0&&m[l].wrongWordsList.push(r.word))};u(c.all),c[e]&&u(c[e])}const p=g=>Object.entries(g).map(([r,{words:l,wrongWordsList:e}])=>({date:r,totalWordsCount:l.length,practicedWords:l,wrongWords:Array.from(new Set(e))})).filter(r=>r.totalWordsCount>0).sort((r,l)=>h(r.date).isBefore(h(l.date))?1:-1);return{stats:{all:p(c.all),typing:p(c.typing),"word-to-trans":p(c["word-to-trans"]),"trans-to-word":p(c["trans-to-word"])}}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(a,s){return this.cache.has(a)?this.cache.get(a):(this.cache.set(a,s),s)}};const Y=()=>{const a=b(),[,s]=w(C),[d,o]=x.useState("all"),i=x.useCallback(()=>{a("/")},[a]),c=()=>{s(e=>!e)};f("ctrl+d",()=>{c()},{enableOnFormTags:!0,preventDefault:!0},[]),f("enter,esc",i,{preventDefault:!0});const{isEmpty:p,stats:g}=A(h().subtract(1,"year").unix(),h().unix()),r=g?g[d]||[]:[];return t(v,{children:n("div",{className:"flex w-full flex-1 flex-col overflow-y-auto pl-20 pr-20 pt-20",children:[t(N,{className:"absolute right-20 top-10 mr-2 h-7 w-7 cursor-pointer text-gray-400",onClick:i}),n(k,{className:"flex-1 overflow-y-auto",children:[t(W,{className:"h-full w-auto pb-[20rem] [&>div]:!block",children:p?t("div",{className:"align-items-center m-4 grid h-80 w-auto place-content-center overflow-hidden rounded-lg shadow-lg dark:bg-gray-600",children:t("div",{className:"text-2xl text-gray-400",children:"暂无练习数据"})}):t($,{children:n("div",{className:"mx-4 my-8 h-auto w-auto overflow-hidden rounded-lg p-8 shadow-lg dark:bg-gray-700 dark:bg-opacity-50",children:[n("div",{className:"mb-6 flex items-center justify-between",children:[t("h2",{className:"text-xl font-bold text-gray-700 dark:text-gray-200",children:"每日练习详情"}),t("div",{className:"flex gap-2",children:[{id:"all",name:"汇总"},{id:"typing",name:"背默单词"},{id:"word-to-trans",name:"英译中"},{id:"trans-to-word",name:"中译英"}].map(e=>t("button",{onClick:()=>o(e.id),className:`rounded-md px-3 py-1 text-sm transition-colors ${d===e.id?"bg-indigo-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-300 dark:hover:bg-gray-500"}`,children:e.name},e.id))})]}),t("div",{className:"flex flex-col gap-6",children:r.map(e=>n("div",{className:"rounded-xl border border-gray-200 bg-white/50 p-6 dark:border-gray-600 dark:bg-gray-800/50",children:[n("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-4 border-b border-gray-100 pb-4 dark:border-gray-700",children:[n("div",{className:"flex items-center gap-3",children:[t("span",{className:"text-lg font-bold text-indigo-500",children:e.date}),t("span",{className:"rounded-full bg-indigo-100 px-3 py-1 text-xs font-medium text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-300",children:h(e.date).format("dddd")})]}),n("div",{className:"flex gap-4 text-sm text-gray-500 dark:text-gray-400",children:[n("span",{children:["总词数: ",t("span",{className:"font-semibold text-gray-900 dark:text-gray-200",children:e.totalWordsCount})]}),n("span",{children:["错词数: ",t("span",{className:"font-semibold text-red-500",children:e.wrongWords.length})]})]})]}),e.wrongWords.length>0&&n("div",{className:"mb-4",children:[t("span",{className:"mb-2 block text-sm font-semibold text-red-500",children:"错词列表"}),t("div",{className:"flex flex-wrap gap-2",children:e.wrongWords.map((u,m)=>t("span",{className:"rounded-md bg-red-50 px-2 py-1 text-sm text-red-600 ring-1 ring-inset ring-red-500/10 dark:bg-red-900/20 dark:text-red-400 dark:ring-red-500/20",children:u},`${e.date}-wrong-${m}`))})]}),t("div",{children:n("details",{className:"group",children:[n("summary",{className:"flex cursor-pointer items-center gap-2 text-sm font-semibold text-gray-600 transition-colors hover:text-indigo-600 dark:text-gray-300 dark:hover:text-indigo-400",children:[t("span",{className:"transition-transform duration-200 group-open:rotate-90",children:"▶"}),"练习单词列表 (",e.practicedWords.length,")"]}),t("div",{className:"mt-3 flex flex-wrap gap-2 pl-4",children:e.practicedWords.map((u,m)=>t("span",{className:"rounded-md bg-gray-100 px-2 py-1 text-sm text-gray-600 dark:bg-gray-700 dark:text-gray-300",children:u},`${e.date}-word-${m}`))})]})})]},e.date))})]})})}),t(D,{className:"flex touch-none select-none bg-transparent ",orientation:"vertical"})]}),t("div",{className:"overflow-y-auto"})]})})};export{Y as default};
